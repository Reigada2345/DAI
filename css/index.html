<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUB</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">


    <style> 
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #f4f4f4;
        }

        /* Estilo do menu no topo */
        .navbar {
            width: 100%;
            background-color: #2c72b7;
            color: white;
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h2 {
            margin: 0;
        }

        .navbar ul {
            list-style: none;
            display: flex;
        }

        .navbar ul li {
            padding: 10px 20px;
        }

        .navbar ul li a {
            color: white;
            text-decoration: none;
            font-size: 16px;
        }

        .navbar ul li:hover {
            background-color: #1a436c;
            border-radius: 5px;
        }

        /* Estilo do conteúdo principal */
        .main-content {
            margin-top: 70px;
            padding: 20px;
            text-align: center;
        }

        .header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .button-link {
    display: inline-block;
    background-color: #2c72b7;
    color: white;
    text-decoration: none;
    padding: 10px 20px;
    border-radius: 5px;
    font-size: 16px;
    text-align: center;
    transition: background-color 0.3s ease;
}

.button-link:hover {
    background-color: #1a436c;
}
 /* Estilo dos cartões de autocarros */
 .bus-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .bus-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
            width: 300px;
            text-align: center;
            padding: 20px;
        }
        .bus-card img {
            width: 100%;
            border-radius: 10px;
        }
        .bus-card button {
            background-color: #2c72b7;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        .bus-card button:hover {
            background-color: #1a436c;
        }

        .bus-table {
            display: none;
            margin-top: 20px;
        }

        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px auto;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #2c72b7;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }
        #map {
            height: 400px; /* Define a altura do mapa */
            width: 100%; /* Define a largura do mapa */
            margin-bottom: 20px;
        }
        .main-content {
        margin-top: 70px; /* Ajuste para compensar a altura da navbar */
        padding: 20px;
        text-align: center;
    }
        body {
            font-family: Montserrat, sans-serif;
            ;
            display: flex;
            justify-content: center;
            align-items: center;      
            height: 100vh;
            background-color: #f4f4f4;
            flex-direction: column;
            margin: 0;    
        } 
        
        h1 {
            
            font-family: 'Poppins', sans-serif;
            font-weight: 700; /* Deixa a fonte mais parecida com o logótipo */
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .login-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 320px;
            text-align: center;
            margin: 0 auto;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #2c72b7;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #1a436c;
        }
    </style>
</head>
<body>
   
   <h1>TUB</h1>
    <div class="login-container">
        <h2 id="formTitle">Login</h2>

        <form id="loginForm">
            <select id="userType" name="userType" style="display: none;" >
                <option value="" disabled selected>Selecione o tipo de utilizador</option>
                <option value="admin">Administrador</option>
                <option value="cliente">Cliente</option>
            </select>
            <input type="text" id="firstName" name="firstName" placeholder="Nome Próprio" style="display: none;" >
            <input type="text" id="lastName" name="lastName" placeholder="Apelido" style="display: none;" >
            <input type="text" id="contact" name="contact" placeholder="Contacto" style="display: none;" >
            <select id="disability" name="disability" style="display: none;" >
                <option value="" disabled selected>É utilizador prioritário?</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
            </select>
            <input type="email" id="email" name="email" placeholder="E-mail" required>
            <input type="password" id="password" name="password" placeholder="Senha" required>
            <button type="submit" id="submitButton">Entrar</button>
        </form>

        <p id="toggleForm" style="cursor: pointer; color: #2c72b7; text-decoration: underline;">Criar uma conta</p>

    </div>
    

    <script>
  
    const formTitle = document.getElementById("formTitle");
    const loginForm = document.getElementById("loginForm");
    const toggleForm = document.getElementById("toggleForm");
    const submitButton = document.getElementById("submitButton");

    const userTypeField = document.getElementById("userType");
    const firstNameField = document.getElementById("firstName");
    const lastNameField = document.getElementById("lastName");
    const contactField = document.getElementById("contact");
    const disabilityField = document.getElementById("disability");

    let isLogin = true;
    toggleForm.addEventListener
    ("click", () => 
        {
                isLogin = !isLogin;

                formTitle.textContent = isLogin ? "Login" : "Criar Conta";
                submitButton.textContent = isLogin ? "Entrar" : "Registrar";
                toggleForm.textContent = isLogin ? "Criar uma conta" : "Já tem uma conta? Login";

                // Mostrar ou esconder os campos do registo
                const display = isLogin ? "none" : "block";
                userTypeField.style.display = display;
                firstNameField.style.display = display;
                lastNameField.style.display = display;
                contactField.style.display = display;
                disabilityField.style.display = display;

                // Torna os campos obrigatórios só quando for registo
                userTypeField.required = !isLogin;
                firstNameField.required = !isLogin;
                lastNameField.required = !isLogin;
                contactField.required = !isLogin;
                disabilityField.required = !isLogin;
        }
    );


    loginForm.addEventListener
    (   "submit", function (event) 
        {
            event.preventDefault();

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();
            const userType = isLogin ? document.getElementById("userType").value : null;

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) 
            {
                alert("Por favor, insira um e-mail válido.");
                return;
            }

            if (!password) {
                alert("Por favor, insira a senha.");
                return;
            }

            if (isLogin) 
            {
                // --- LOGIN ---
                if (isLogin && email === "admin@email.com" && password === "1234") 
                {
                   window.location.href = "dashboard.html";
                 
                    return;
                }

                // Tenta login no backend
                fetch("https://apptub-hac2fta6afcsdqhq.northeurope-01.azurewebsites.net/login", {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json' // Definindo que estamos enviando JSON
                    },
                    body: JSON.stringify({
                        'email': email,
                        'password': password
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro na requisição: ' + response.status);
                    }
                    return response.text(); // A resposta será tratada como texto
                })
                .then(data => {
                    if (data === "Sucesso") {
                        // Login bem-sucedido
                        window.location.href = "dashboard.html";
                    } else if (data === "Erro") {
                        // E-mail ou senha incorretos
                        alert("E-mail ou senha incorretos.");
                    } else {
                        // Caso o servidor retorne algo inesperado
                        alert("Resposta inesperada do servidor.");
                    }
                })
                .catch(error => {
                    console.error("Erro ao fazer login:", error);
                    alert("Houve um erro ao tentar fazer login. Tente novamente.");
                });
    
                    // Verifica se o utilizador existe
                    const user = JSON.parse(localStorage.getItem(email));
                    if (!user || user.password !== password) 
                    {
                        alert("E-mail ou senha incorretos.");
                        return;
                    }
    
                    // Verifica se o utilizador é cliente
                    if (user.userType !== "cliente") 
                    {
                        alert("Apenas clientes podem fazer login.");
                        return;
                    }
    
                    // Login bem-sucedido
                    window.location.href = "dashboard.html";


            } 
            else 
            {
                // --- REGISTO ---
                if (!userType || userType !== "cliente") 
                {
                    alert("Apenas clientes podem criar conta.");
                    return;
                }

                const newUser = 
                {
                    email: email,
                    password: password,
                    userType: userType,
                    firstName: document.getElementById("firstName").value.trim(),
                    lastName: document.getElementById("lastName").value.trim(),
                    contact: document.getElementById("contact").value.trim(),
                    disability: document.getElementById("disability").value
                };

                // Verifica campos
                if (!newUser.firstName || !newUser.lastName || !newUser.contact || !newUser.disability) 
                {
                    alert("Preencha todos os campos obrigatórios.");
                    return;
                }

                localStorage.setItem(email, JSON.stringify(newUser));
                
                
                
                alert("Conta criada com sucesso!");

                // Volta para modo login
                isLogin = true;
                toggleForm.click();
            }
    });
</script>
